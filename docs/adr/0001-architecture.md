# ADR-0001: å…­è¾¹å½¢æ¶æ„ + DDD åˆ†å±‚

## çŠ¶æ€
å·²é‡‡çº³

## ä¸Šä¸‹æ–‡

åœ¨æ„å»º Bento DDD æ¡†æ¶æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ¸…æ™°çš„æ¶æ„æ¨¡å¼æ¥ï¼š
- å°†ä¸šåŠ¡é€»è¾‘ä¸æŠ€æœ¯å®ç°è§£è€¦
- æ”¯æŒå¤šç§æ¥å£ç±»å‹ï¼ˆHTTP, gRPC, GraphQL, CLIï¼‰
- ä¾¿äºæµ‹è¯•å’Œæ›¿æ¢åŸºç¡€è®¾æ–½ç»„ä»¶
- ä¿æŒé¢†åŸŸæ¨¡å‹çš„çº¯ç²¹æ€§

## å†³ç­–

æˆ‘ä»¬é‡‡ç”¨**å…­è¾¹å½¢æ¶æ„**ï¼ˆHexagonal Architectureï¼Œä¹Ÿç§°ç«¯å£ä¸é€‚é…å™¨æ¨¡å¼ï¼‰ç»“åˆ **DDD æˆ˜æœ¯è®¾è®¡**ã€‚

## å…­è¾¹å½¢æ¶æ„æ ¸å¿ƒåŸåˆ™

### 1. æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å¤–å±‚ï¼šé€‚é…å™¨                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  HTTP API   â”‚  â”‚   gRPC      â”‚  â”‚  GraphQL    â”‚  é©±åŠ¨ä¾§ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ (Primary)â”‚
â”‚         â”‚                â”‚                â”‚                 â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                          â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚            åº”ç”¨å±‚ (Application)                   â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚
â”‚  â”‚  â”‚  Use Cases  â”‚  â”‚   UoW    â”‚  â”‚    Saga     â”‚  â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                      â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚            é¢†åŸŸå±‚ (Domain)                        â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚     â”‚
â”‚  â”‚  â”‚ Entity   â”‚  â”‚VO/Event  â”‚  â”‚ DomainServiceâ”‚    â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                      â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚          åŸºç¡€è®¾æ–½å±‚ (Infrastructure)                â”‚   â”‚
â”‚  â”‚  ç«¯å£ â†â†’ é€‚é…å™¨                                    â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ Repository Port â†’ SQLAlchemy / InMemory            â”‚   â”‚
â”‚  â”‚ EventBus Port   â†’ Pulsar / Redis / InMemory        â”‚   â”‚
â”‚  â”‚ Cache Port      â†’ Redis / Memcached                â”‚   â”‚
â”‚  â”‚ Storage Port    â†’ MinIO / S3 / FileSystem          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚                                          è¢«é©±åŠ¨ä¾§(Secondary)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. åˆ†å±‚èŒè´£

#### ğŸ¯ Coreï¼ˆæ ¸å¿ƒå±‚ï¼‰
**è·¯å¾„**: `src/core/`  
**èŒè´£**: æä¾›æ¡†æ¶çº§åˆ«çš„åŸºç¡€æŠ½è±¡ï¼Œä¸ä¾èµ–ä»»ä½•å…¶ä»–å±‚
- `Result<T,E>`: å‡½æ•°å¼é”™è¯¯å¤„ç†
- `EntityId`: ç»Ÿä¸€çš„å®ä½“æ ‡è¯†
- `Guard`: å‰ç½®æ¡ä»¶æ£€æŸ¥
- `Clock`: æ—¶é—´æŠ½è±¡

**åŸåˆ™**:
- âœ… é›¶ä¾èµ–ï¼ˆé™¤äº† Python æ ‡å‡†åº“ï¼‰
- âœ… çº¯å‡½æ•°ï¼Œæ— å‰¯ä½œç”¨
- âŒ ä¸èƒ½å¯¼å…¥å…¶ä»–ä¸šåŠ¡å±‚

#### ğŸ¯ Domainï¼ˆé¢†åŸŸå±‚ï¼‰
**è·¯å¾„**: `src/domain/`  
**èŒè´£**: å°è£…æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å’Œè§„åˆ™
- `Entity`: æœ‰å”¯ä¸€æ ‡è¯†çš„é¢†åŸŸå¯¹è±¡
- `ValueObject`: ä¸å¯å˜çš„å€¼å¯¹è±¡
- `AggregateRoot`: èšåˆæ ¹ï¼Œäº‹åŠ¡è¾¹ç•Œ
- `DomainEvent`: é¢†åŸŸäº‹ä»¶
- `Repository (Protocol)`: ä»“å‚¨æ¥å£ï¼ˆç«¯å£ï¼‰
- `Specification`: ä¸šåŠ¡è§„åˆ™å°è£…

**åŸåˆ™**:
- âœ… åªä¾èµ– `core`
- âœ… çº¯ä¸šåŠ¡é€»è¾‘ï¼Œä¸æŠ€æœ¯æ— å…³
- âŒ ä¸èƒ½æœ‰ä»»ä½• I/O æ“ä½œ
- âŒ ä¸èƒ½ä¾èµ–æ¡†æ¶ï¼ˆFastAPI, SQLAlchemy ç­‰ï¼‰

#### ğŸ¯ Applicationï¼ˆåº”ç”¨å±‚ï¼‰
**è·¯å¾„**: `src/application/`  
**èŒè´£**: ç¼–æ’ç”¨ä¾‹ï¼Œåè°ƒé¢†åŸŸå¯¹è±¡
- `UseCase`: ç”¨ä¾‹å…¥å£ï¼ˆå‘½ä»¤/æŸ¥è¯¢ï¼‰
- `UnitOfWork`: å·¥ä½œå•å…ƒæ¨¡å¼
- `Saga`: åˆ†å¸ƒå¼äº‹åŠ¡ç¼–æ’
- `DTO`: æ•°æ®ä¼ è¾“å¯¹è±¡

**åŸåˆ™**:
- âœ… ä¾èµ– `core` + `domain` çš„ç«¯å£
- âœ… é€šè¿‡ä¾èµ–æ³¨å…¥è·å–åŸºç¡€è®¾æ–½å®ç°
- âŒ ä¸ç›´æ¥ä¾èµ–å…·ä½“çš„é€‚é…å™¨å®ç°

#### ğŸ¯ Infrastructureï¼ˆåŸºç¡€è®¾æ–½å±‚ï¼‰
**è·¯å¾„**: `src/infrastructure/`  
**èŒè´£**: å®ç°é¢†åŸŸå±‚å®šä¹‰çš„ç«¯å£
- `cache.py`: ç¼“å­˜é€‚é…å™¨
- `storage.py`: å¯¹è±¡å­˜å‚¨é€‚é…å™¨
- `emailer.py`: é‚®ä»¶å‘é€é€‚é…å™¨
- `locker.py`: åˆ†å¸ƒå¼é”é€‚é…å™¨

**åŸåˆ™**:
- âœ… å®ç° `domain` ä¸­å®šä¹‰çš„ Protocol
- âœ… å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ï¼ˆRedis, MinIO ç­‰ï¼‰
- âœ… å¯æ›¿æ¢ï¼ˆé€šè¿‡ä¾èµ–æ³¨å…¥åˆ‡æ¢å®ç°ï¼‰

#### ğŸ¯ Persistenceï¼ˆæŒä¹…åŒ–å±‚ï¼‰
**è·¯å¾„**: `src/persistence/`  
**èŒè´£**: æ•°æ®æŒä¹…åŒ–çš„å…·ä½“å®ç°
- `InMemoryRepository`: å†…å­˜ä»“å‚¨ï¼ˆæµ‹è¯•ç”¨ï¼‰
- `SQLAlchemyRepository`: SQL ä»“å‚¨
- `OutboxRepository`: Outbox æ¨¡å¼å®ç°

#### ğŸ¯ Messagingï¼ˆæ¶ˆæ¯å±‚ï¼‰
**è·¯å¾„**: `src/messaging/`  
**èŒè´£**: äº‹ä»¶é©±åŠ¨æ¶æ„æ”¯æŒ
- `EventBus (Protocol)`: äº‹ä»¶æ€»çº¿ç«¯å£
- `Outbox (Protocol)`: å‘ä»¶ç®±æ¨¡å¼ç«¯å£
- `codec.py`: æ¶ˆæ¯åºåˆ—åŒ–

#### ğŸ¯ Interfacesï¼ˆæ¥å£å±‚ï¼‰
**è·¯å¾„**: `src/interfaces/`  
**èŒè´£**: å¯¹å¤–æä¾›çš„é©±åŠ¨é€‚é…å™¨
- `http.py`: REST APIï¼ˆFastAPIï¼‰
- `grpc.py`: gRPC æœåŠ¡
- `graphql.py`: GraphQL API
- `scheduler.py`: å®šæ—¶ä»»åŠ¡

**åŸåˆ™**:
- âœ… è°ƒç”¨ `application` å±‚çš„ UseCase
- âœ… å¤„ç†åè®®è½¬æ¢ï¼ˆHTTP â†’ DTOï¼‰
- âŒ ä¸ç›´æ¥è°ƒç”¨ `domain` å±‚

### 3. ä¾èµ–è§„åˆ™ï¼ˆæ´‹è‘±æ¨¡å‹ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Interfaces (HTTP/gRPC)          â”‚ â”€â”
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚      Infrastructure (SQLAlchemy)     â”‚  â”‚  å¤–å±‚ä¾èµ–å†…å±‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚      Application (UseCases)          â”‚  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚      Domain (Entities/Events)        â”‚  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚      Core (Result/Guard)             â”‚ â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¾èµ–æ–¹å‘ï¼šå•å‘å‘å†…ï¼ˆå¤–å±‚ â†’ å†…å±‚ï¼‰
```

**å¼ºåˆ¶æ‰§è¡Œ**ï¼ˆé€šè¿‡ import-linterï¼‰:
```python
# pyproject.toml
[[tool.importlinter.contracts]]
name = "Hexagonal layering"
type = "layers"
layers = [
  "core",           # æœ€å†…å±‚
  "domain",
  "application",
  "infrastructure",
  "interfaces",     # æœ€å¤–å±‚
]
```

### 4. ç«¯å£ä¸é€‚é…å™¨æ¨¡å¼

#### ç«¯å£ï¼ˆPortsï¼‰
ä½¿ç”¨ Python `Protocol` å®šä¹‰å¥‘çº¦ï¼š

```python
# domain/repository.py - ç«¯å£å®šä¹‰
from typing import Protocol, Generic, TypeVar

T = TypeVar("T")

class Repository(Protocol, Generic[T]):
    """ä»“å‚¨ç«¯å£ - ç”±åŸºç¡€è®¾æ–½å±‚å®ç°"""
    async def get(self, id: EntityId) -> Optional[T]: ...
    async def save(self, entity: T) -> None: ...
```

#### é€‚é…å™¨ï¼ˆAdaptersï¼‰
å®ç°ç«¯å£çš„å…·ä½“æŠ€æœ¯æ–¹æ¡ˆï¼š

**é©±åŠ¨ä¾§é€‚é…å™¨**ï¼ˆå¤–éƒ¨ â†’ åº”ç”¨ï¼‰:
- HTTP Adapter (`interfaces/http.py`)
- gRPC Adapter (`interfaces/grpc.py`)
- CLI Adapter (`toolkit/cli.py`)

**è¢«é©±åŠ¨ä¾§é€‚é…å™¨**ï¼ˆåº”ç”¨ â†’ å¤–éƒ¨ï¼‰:
- SQLAlchemy Repository (`persistence/sqlalchemy/`)
- Pulsar EventBus (`messaging/pulsar_bus.py`) - ä¼˜å…ˆ
- Kafka EventBus (`messaging/kafka_bus.py`) - å¯é€‰
- Redis Cache (`infrastructure/redis_cache.py`)

### 5. é¢†åŸŸäº‹ä»¶ + Outbox æ¨¡å¼

#### ä¸ºä»€ä¹ˆéœ€è¦ Outboxï¼Ÿ
è§£å†³**åˆ†å¸ƒå¼äº‹åŠ¡ä¸€è‡´æ€§**é—®é¢˜ï¼š
- æ•°æ®åº“äº‹åŠ¡æäº¤ âœ…
- äº‹ä»¶å‘é€å¤±è´¥ âŒ â† å¯¼è‡´ä¸ä¸€è‡´

#### Outbox å·¥ä½œæµç¨‹

```
1. ä¸šåŠ¡æ“ä½œ
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  AggregateRoot  â”‚
   â”‚  åˆ›å»º/ä¿®æ”¹å®ä½“  â”‚
   â”‚  record_event() â”‚ â† æ”¶é›†é¢†åŸŸäº‹ä»¶
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â–¼
2. äº‹åŠ¡å†…å†™å…¥
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   UnitOfWork.commit()    â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚ BEGIN TRANSACTION        â”‚
   â”‚   UPDATE entity_table    â”‚
   â”‚   INSERT INTO outbox     â”‚ â† åŒä¸€äº‹åŠ¡
   â”‚ COMMIT                   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â–¼
3. å¼‚æ­¥å‘å¸ƒï¼ˆç‹¬ç«‹è¿›ç¨‹ï¼‰
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  OutboxPublisher (Job)   â”‚
   â”‚  SELECT * FROM outbox    â”‚
   â”‚  WHERE published = false â”‚
   â”‚   â†“                      â”‚
   â”‚  Publish to Pulsar       â”‚
   â”‚   â†“                      â”‚
   â”‚  UPDATE outbox           â”‚
   â”‚  SET published = true    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å®ç°ç¤ºä¾‹

```python
# persistence/uow.py (see SQLAlchemyUnitOfWork class)
class SQLAlchemyUnitOfWork:
    async def commit(self) -> None:
        # 1. æ”¶é›†èšåˆçš„é¢†åŸŸäº‹ä»¶
        events = []
        for aggregate in self._tracked_aggregates:
            events.extend(aggregate.collect_events())
        
        # 2. åŒä¸€äº‹åŠ¡å†…å†™å…¥ Outbox
        for event in events:
            outbox_record = OutboxMessage(
                topic=event.name,
                payload=event.to_dict(),
                created_at=now_utc(),
            )
            self.session.add(outbox_record)
        
        # 3. æäº¤äº‹åŠ¡ï¼ˆåŸå­æ€§ä¿è¯ï¼‰
        await self.session.commit()
```

### 6. æµ‹è¯•ç­–ç•¥

#### å•å…ƒæµ‹è¯•ï¼ˆDomainï¼‰
```python
# çº¯é¢†åŸŸé€»è¾‘ï¼Œæ— éœ€ Mock
def test_order_cannot_exceed_limit():
    order = Order.create(items=[...])
    assert order.total_amount <= Money(10000, "USD")
```

#### é›†æˆæµ‹è¯•ï¼ˆApplicationï¼‰
```python
# ä½¿ç”¨ InMemory é€‚é…å™¨
async def test_create_order_usecase():
    repo = InMemoryOrderRepository()
    uow = InMemoryUnitOfWork()
    usecase = CreateOrder(repo, uow)
    
    result = await usecase(CreateOrderInput(...))
    assert result.is_ok
```

#### E2E æµ‹è¯•ï¼ˆInterfacesï¼‰
```python
# å®Œæ•´çš„ HTTP â†’ DB æµç¨‹
async def test_order_api_flow(client: TestClient):
    response = await client.post("/api/orders", json={...})
    assert response.status_code == 201
```

## ç»“æœ

### æ”¶ç›Š
âœ… **å¯æµ‹è¯•æ€§**: é¢†åŸŸå±‚å¯ç‹¬ç«‹æµ‹è¯•ï¼Œæ— éœ€æ•°æ®åº“  
âœ… **å¯æ›¿æ¢æ€§**: åŸºç¡€è®¾æ–½ç»„ä»¶å¯çƒ­æ’æ‹”  
âœ… **æ¸…æ™°è¾¹ç•Œ**: æ¯å±‚èŒè´£æ˜ç¡®ï¼Œé™ä½è€¦åˆ  
âœ… **æŠ€æœ¯æ— å…³**: é¢†åŸŸæ¨¡å‹ä¸å—æ¡†æ¶æŸç¼š  
âœ… **äº‹ä»¶ä¸€è‡´æ€§**: Outbox æ¨¡å¼ä¿è¯æœ€ç»ˆä¸€è‡´æ€§  

### æƒè¡¡
âš ï¸ **å­¦ä¹ æ›²çº¿**: éœ€è¦ç†è§£ DDD å’Œå…­è¾¹å½¢æ¶æ„  
âš ï¸ **åˆæœŸå¤æ‚**: å°é¡¹ç›®å¯èƒ½è¿‡åº¦è®¾è®¡  
âš ï¸ **æ–‡ä»¶æ•°é‡**: åˆ†å±‚å¯¼è‡´æ–‡ä»¶è¾ƒå¤š  

## å‚è€ƒèµ„æ–™
- [Hexagonal Architecture](https://alistair.cockburn.us/hexagonal-architecture/) - Alistair Cockburn
- [Domain-Driven Design](https://www.domainlanguage.com/ddd/) - Eric Evans
- [Implementing Domain-Driven Design](https://vaughnvernon.com/) - Vaughn Vernon
- [Transactional Outbox Pattern](https://microservices.io/patterns/data/transactional-outbox.html)

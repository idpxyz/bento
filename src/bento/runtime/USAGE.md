# Bento Runtime çš„ä¸»è¦ç”¨é€”åˆ†æ

**åˆ†ææ—¥æœŸ**: 2024-12-29
**åˆ†æå¯¹è±¡**: `/workspace/bento/src/bento/runtime`
**æ ¸å¿ƒé—®é¢˜**: Runtime çš„ä¸»è¦ç”¨é€”æ˜¯ä»€ä¹ˆï¼Ÿ

---

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

### æ ¸å¿ƒå®šä½

**Bento Runtime æ˜¯ä¸€ä¸ªåº”ç”¨å¯åŠ¨å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†æ¡†æ¶**

å®ƒå°†ä»¥ä¸‹åŠŸèƒ½ç»Ÿä¸€åˆ°ä¸€ä¸ªç®€æ´çš„ API ä¸­ï¼š
1. **æ¨¡å—ç³»ç»Ÿ** - LOMS é£æ ¼çš„æ¨¡å—æ³¨å†Œå’Œä¾èµ–ç®¡ç†
2. **ä¾èµ–æ³¨å…¥** - è½»é‡çº§ DI å®¹å™¨
3. **FastAPI é›†æˆ** - è‡ªåŠ¨åŒ–çš„ FastAPI åº”ç”¨åˆ›å»ºå’Œç”Ÿå‘½å‘¨æœŸç®¡ç†
4. **æ•°æ®åº“ç®¡ç†** - æ•°æ®åº“é…ç½®å’Œä¼šè¯å·¥å‚ç®¡ç†
5. **å¥‘çº¦éªŒè¯** - å¯åŠ¨æ—¶çš„æ¶æ„å¥‘çº¦éªŒè¯
6. **å¯è§‚æµ‹æ€§** - æ€§èƒ½ç›‘æ§ã€æ—¥å¿—ã€è¿½è¸ª

---

## ğŸ¯ Runtime çš„ 7 å¤§ä¸»è¦ç”¨é€”

### 1ï¸âƒ£ **åº”ç”¨å¯åŠ¨å’Œåˆå§‹åŒ–**

**ç›®çš„**: ç»Ÿä¸€çš„åº”ç”¨å¯åŠ¨æµç¨‹

**æ ¸å¿ƒæ–¹æ³•**:
```python
runtime = (
    RuntimeBuilder()
    .with_config(service_name="my-shop", environment="local")
    .with_database(url=settings.database_url)
    .with_modules(InfraModule(), CatalogModule(), OrderingModule())
    .build_runtime()
)

app = runtime.create_fastapi_app(title="My Shop API")
```

**åšäº†ä»€ä¹ˆ**:
- âœ… é…ç½®åº”ç”¨å‚æ•°ï¼ˆæœåŠ¡åã€ç¯å¢ƒã€æ•°æ®åº“ï¼‰
- âœ… æ³¨å†Œæ‰€æœ‰æ¨¡å—
- âœ… éªŒè¯æ¨¡å—ä¾èµ–å…³ç³»
- âœ… æ‰§è¡Œå¯åŠ¨é—¨ç¦ï¼ˆgatesï¼‰
- âœ… åˆå§‹åŒ–æ•°æ®åº“
- âœ… åˆ›å»º FastAPI åº”ç”¨
- âœ… é…ç½®ç”Ÿå‘½å‘¨æœŸç®¡ç†

**ä¼˜åŠ¿**:
- ä¸€è¡Œä»£ç å¯åŠ¨æ•´ä¸ªåº”ç”¨
- è‡ªåŠ¨å¤„ç†å¤æ‚çš„åˆå§‹åŒ–é¡ºåº
- ç»Ÿä¸€çš„é…ç½®ç®¡ç†

---

### 2ï¸âƒ£ **æ¨¡å—ç³»ç»Ÿå’Œä¾èµ–ç®¡ç†**

**ç›®çš„**: ç»„ç»‡ä»£ç ä¸ºç‹¬ç«‹çš„ã€å¯å¤ç”¨çš„æ¨¡å—

**æ¨¡å—å®šä¹‰**:
```python
class InfraModule(BentoModule):
    """åŸºç¡€è®¾æ–½æ¨¡å—"""
    name = "infra"
    requires_database = True

    async def on_register(self, container):
        # æ³¨å†Œæ•°æ®åº“ã€ç¼“å­˜ç­‰åŸºç¡€è®¾æ–½
        session_factory = create_session_factory()
        container.set("db.session_factory", session_factory)

        cache = await create_cache()
        container.set("cache", cache)

    async def on_startup(self, container):
        # å¯åŠ¨æ—¶åˆå§‹åŒ–
        pass

    async def on_shutdown(self, container):
        # å…³é—­æ—¶æ¸…ç†
        pass

    def get_routers(self):
        # è¿”å› FastAPI è·¯ç”±
        return []

class CatalogModule(BentoModule):
    """ç›®å½•æ¨¡å—"""
    name = "catalog"
    requires = ["infra"]  # ä¾èµ– InfraModule

    async def on_register(self, container):
        # ä½¿ç”¨ infra æ¨¡å—æä¾›çš„æœåŠ¡
        session_factory = container.get("db.session_factory")
        container.set("catalog.repo", CategoryRepository(session_factory))

    def get_routers(self):
        from contexts.catalog.interfaces.http import router
        return [router]
```

**Runtime çš„ä½œç”¨**:
- âœ… è‡ªåŠ¨æ‹“æ‰‘æ’åºï¼ˆè§£å†³ä¾èµ–é¡ºåºï¼‰
- âœ… æŒ‰é¡ºåºåˆå§‹åŒ–æ¨¡å—
- âœ… è‡ªåŠ¨æ³¨å†Œè·¯ç”±
- âœ… ç®¡ç†æ¨¡å—ç”Ÿå‘½å‘¨æœŸ

**ä¼˜åŠ¿**:
- ä»£ç æ¨¡å—åŒ–å’Œå¯å¤ç”¨
- æ¸…æ™°çš„ä¾èµ–å…³ç³»
- æ˜“äºæµ‹è¯•ï¼ˆå¯ä»¥åŠ è½½éƒ¨åˆ†æ¨¡å—ï¼‰
- æ”¯æŒçƒ­é‡è½½ï¼ˆè¿è¡Œæ—¶åŠ è½½/å¸è½½æ¨¡å—ï¼‰

---

### 3ï¸âƒ£ **ä¾èµ–æ³¨å…¥å®¹å™¨**

**ç›®çš„**: ç®¡ç†åº”ç”¨ä¸­çš„æ‰€æœ‰æœåŠ¡å’Œä¾èµ–

**å®¹å™¨åŠŸèƒ½**:
```python
# æ³¨å†ŒæœåŠ¡
container.set("config", config)
container.set("db.engine", engine)
container.set("cache", cache)

# è·å–æœåŠ¡
config = container.get("config")
cache = container.get("cache")

# æ³¨å†Œå·¥å‚ï¼ˆå»¶è¿Ÿåˆå§‹åŒ–ï¼‰
container.set_factory("db.session", lambda: session_factory())

# åˆ›å»ºä½œç”¨åŸŸï¼ˆè¯·æ±‚çº§åˆ«çš„éš”ç¦»ï¼‰
with container.create_scope() as scope:
    session = scope.get("db.session")
```

**Runtime çš„ä½œç”¨**:
- âœ… æä¾›è½»é‡çº§ DI å®¹å™¨
- âœ… æ”¯æŒå¤šç§ç”Ÿå‘½å‘¨æœŸï¼ˆSingletonã€Transientã€Scopedï¼‰
- âœ… é›†æˆ FastAPI ä¾èµ–æ³¨å…¥

**ä¼˜åŠ¿**:
- è§£è€¦åº”ç”¨ç»„ä»¶
- ä¾¿äºå•å…ƒæµ‹è¯•ï¼ˆå¯ä»¥æ³¨å…¥ Mockï¼‰
- æ”¯æŒå¤šç§é…ç½®æ–¹å¼

---

### 4ï¸âƒ£ **FastAPI é›†æˆå’Œç”Ÿå‘½å‘¨æœŸç®¡ç†**

**ç›®çš„**: è‡ªåŠ¨åŒ– FastAPI åº”ç”¨çš„åˆ›å»ºå’Œç”Ÿå‘½å‘¨æœŸç®¡ç†

**æ ¸å¿ƒåŠŸèƒ½**:
```python
# åˆ›å»º FastAPI åº”ç”¨
app = runtime.create_fastapi_app(
    title="My Shop API",
    description="E-commerce platform",
    version="1.0.0",
    docs_url="/docs"
)

# Runtime è‡ªåŠ¨å¤„ç†ï¼š
# 1. åˆ›å»º FastAPI åº”ç”¨
# 2. é…ç½® lifespan äº‹ä»¶
# 3. æ³¨å†Œæ‰€æœ‰æ¨¡å—çš„è·¯ç”±
# 4. é…ç½®å¼‚å¸¸å¤„ç†
# 5. é…ç½®ä¸­é—´ä»¶
# 6. å¯åŠ¨/å…³é—­é’©å­
```

**ç”Ÿå‘½å‘¨æœŸç®¡ç†**:
```python
# å¯åŠ¨äº‹ä»¶
async def lifespan(app: FastAPI):
    # å¯åŠ¨
    await runtime.startup()
    yield
    # å…³é—­
    await runtime.shutdown()

# Runtime è‡ªåŠ¨è°ƒç”¨æ‰€æœ‰æ¨¡å—çš„ï¼š
# - on_startup() é’©å­
# - on_shutdown() é’©å­
```

**ä¼˜åŠ¿**:
- è‡ªåŠ¨åŒ– FastAPI é…ç½®
- ç»Ÿä¸€çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†
- æ¨¡å—è·¯ç”±è‡ªåŠ¨æ³¨å†Œ
- å¼‚å¸¸å¤„ç†ç»Ÿä¸€é…ç½®

---

### 5ï¸âƒ£ **æ•°æ®åº“ç®¡ç†**

**ç›®çš„**: ç»Ÿä¸€ç®¡ç†æ•°æ®åº“è¿æ¥å’Œä¼šè¯å·¥å‚

**é…ç½®æ–¹å¼**:
```python
runtime = (
    RuntimeBuilder()
    .with_database(url="sqlite:///app.db")
    .build_runtime()
)

# Runtime è‡ªåŠ¨ï¼š
# 1. åˆ›å»ºæ•°æ®åº“å¼•æ“
# 2. åˆ›å»ºä¼šè¯å·¥å‚
# 3. åˆå§‹åŒ–æ•°æ®åº“ï¼ˆå¦‚æœéœ€è¦ï¼‰
# 4. æ³¨å†Œåˆ° DI å®¹å™¨
```

**ä½¿ç”¨æ–¹å¼**:
```python
# åœ¨æ¨¡å—ä¸­è·å–ä¼šè¯å·¥å‚
class CatalogModule(BentoModule):
    async def on_register(self, container):
        session_factory = container.get("db.session_factory")
        # ä½¿ç”¨ä¼šè¯å·¥å‚åˆ›å»ºä»“å‚¨ç­‰
```

**ä¼˜åŠ¿**:
- ç»Ÿä¸€çš„æ•°æ®åº“é…ç½®
- è‡ªåŠ¨è¿æ¥æ± ç®¡ç†
- æ”¯æŒå¤šç§æ•°æ®åº“ï¼ˆSQLiteã€PostgreSQL ç­‰ï¼‰
- è‡ªåŠ¨æ¸…ç†èµ„æº

---

### 6ï¸âƒ£ **å¥‘çº¦éªŒè¯å’Œå¯åŠ¨é—¨ç¦**

**ç›®çš„**: åœ¨åº”ç”¨å¯åŠ¨å‰éªŒè¯æ¶æ„å¥‘çº¦

**é…ç½®æ–¹å¼**:
```python
runtime = (
    RuntimeBuilder()
    .with_contracts("./contracts", require=True)
    .build_runtime()
)
```

**éªŒè¯å†…å®¹**:
- âœ… OpenAPI è§„èŒƒéªŒè¯
- âœ… äº‹ä»¶ Schema éªŒè¯
- âœ… ä¸šåŠ¡è§„åˆ™éªŒè¯
- âœ… è‡ªå®šä¹‰é—¨ç¦

**ä¼˜åŠ¿**:
- å¯åŠ¨å‰æ£€æµ‹æ¶æ„é—®é¢˜
- ç¡®ä¿ API å’Œäº‹ä»¶çš„ä¸€è‡´æ€§
- é˜²æ­¢ä¸å…¼å®¹çš„å˜æ›´éƒ¨ç½²

---

### 7ï¸âƒ£ **å¯è§‚æµ‹æ€§å’Œæ€§èƒ½ç›‘æ§**

**ç›®çš„**: ç›‘æ§åº”ç”¨å¯åŠ¨å’Œè¿è¡Œæ—¶æ€§èƒ½

**æ€§èƒ½æŒ‡æ ‡**:
```python
# è·å–å¯åŠ¨æŒ‡æ ‡
metrics = runtime.get_startup_metrics()
# {
#     "total_time": 1.234,
#     "gates_time": 0.1,
#     "register_time": 0.5,
#     "database_time": 0.634
# }

# è®°å½•å¯åŠ¨æŒ‡æ ‡
runtime.log_startup_metrics()
```

**å¯è§‚æµ‹æ€§åŠŸèƒ½**:
```python
# å¯ç”¨ OpenTelemetry è¿½è¸ª
runtime.with_otel_tracing(
    service_name="my-shop",
    trace_exporter="jaeger"
)
```

**ä¼˜åŠ¿**:
- æ€§èƒ½é—®é¢˜å¿«é€Ÿå®šä½
- å¯åŠ¨æ—¶é—´ç›‘æ§
- åˆ†å¸ƒå¼è¿½è¸ªæ”¯æŒ

---

## ğŸ—ï¸ Runtime çš„æ¶æ„è®¾è®¡

### åˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   BentoRuntime (æ ¸å¿ƒ)                    â”‚
â”‚                    (393 è¡Œä»£ç )                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RuntimeBuilderâ”‚   â”‚ModuleRegistryâ”‚   â”‚BentoContainerâ”‚
â”‚  (é…ç½®æ„å»º)   â”‚   â”‚  (æ¨¡å—ç®¡ç†)  â”‚   â”‚   (DIå®¹å™¨)   â”‚
â”‚   177 è¡Œ     â”‚   â”‚   146 è¡Œ     â”‚   â”‚   113 è¡Œ     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     é›†æˆç®¡ç†å±‚                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚LifecycleManager â”‚FastAPIIntegrationâ”‚PerformanceMonitor â”‚
â”‚    75 è¡Œ        â”‚     142 è¡Œ       â”‚      68 è¡Œ          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ModuleManager   â”‚  DIIntegration  â”‚ DatabaseManager     â”‚
â”‚    143 è¡Œ       â”‚     93 è¡Œ        â”‚      91 è¡Œ          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åŠŸèƒ½æ¨¡å—å±‚                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  lifecycle/  â”‚ observability/â”‚  database/   â”‚  testing/ â”‚
â”‚  (ç”Ÿå‘½å‘¨æœŸ)  â”‚  (å¯è§‚æµ‹æ€§)   â”‚  (æ•°æ®åº“)    â”‚  (æµ‹è¯•)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶èŒè´£

| ç»„ä»¶ | èŒè´£ | ä»£ç é‡ |
|------|------|--------|
| **BentoRuntime** | æ ¸å¿ƒåè°ƒå™¨ | 393 è¡Œ |
| **RuntimeBuilder** | é…ç½®æ„å»º | 177 è¡Œ |
| **ModuleRegistry** | æ¨¡å—ç®¡ç† | 146 è¡Œ |
| **BentoContainer** | DI å®¹å™¨ | 113 è¡Œ |
| **LifecycleManager** | ç”Ÿå‘½å‘¨æœŸ | 75 è¡Œ |
| **FastAPIIntegration** | FastAPI é›†æˆ | 142 è¡Œ |
| **PerformanceMonitor** | æ€§èƒ½ç›‘æ§ | 68 è¡Œ |
| **ModuleManager** | æ¨¡å—è¿è¡Œæ—¶ç®¡ç† | 143 è¡Œ |
| **DIIntegration** | DI é›†æˆ | 93 è¡Œ |
| **DatabaseManager** | æ•°æ®åº“ç®¡ç† | 91 è¡Œ |

---

## ğŸ’¡ Runtime çš„è®¾è®¡å“²å­¦

### 1. **å¼€ç®±å³ç”¨**

```python
# æœ€ç®€å•çš„ç”¨æ³•
runtime = RuntimeBuilder().with_modules(MyModule()).build_runtime()
app = runtime.create_fastapi_app()
```

**ç‰¹ç‚¹**:
- é»˜è®¤é…ç½®åˆç†
- æœ€å°‘åŒ–å­¦ä¹ æ›²çº¿
- å¿«é€Ÿå¯åŠ¨åº”ç”¨

---

### 2. **æ¸è¿›å¼é…ç½®**

```python
# ç®€å•åº”ç”¨
runtime = RuntimeBuilder().with_modules(MyModule()).build_runtime()

# ä¸­ç­‰åº”ç”¨
runtime = (
    RuntimeBuilder()
    .with_config(service_name="my-app")
    .with_database(url="postgresql://...")
    .with_modules(InfraModule(), CatalogModule())
    .build_runtime()
)

# å¤æ‚åº”ç”¨
runtime = (
    RuntimeBuilder()
    .with_config(service_name="my-app", environment="prod")
    .with_database(url="postgresql://...")
    .with_contracts("./contracts", require=True)
    .with_modules(InfraModule(), CatalogModule(), OrderingModule())
    .with_otel_tracing(service_name="my-app")
    .build_runtime()
)
```

---

### 3. **æ¨¡å—åŒ–å’Œå¯ç»„åˆ**

```python
# æ¯ä¸ªæ¨¡å—ç‹¬ç«‹ï¼Œå¯ç»„åˆ
modules = [
    InfraModule(),           # åŸºç¡€è®¾æ–½
    CatalogModule(),         # ç›®å½•
    OrderingModule(),        # è®¢å•
    PaymentModule(),         # æ”¯ä»˜
]

runtime = RuntimeBuilder().with_modules(*modules).build_runtime()
```

**ä¼˜åŠ¿**:
- æ¨¡å—å¯å¤ç”¨
- æ˜“äºæ‰©å±•
- æ”¯æŒæ’ä»¶æ¶æ„

---

### 4. **çº¦å®šä¼˜äºé…ç½®**

```python
# æ¨¡å—åç§°è‡ªåŠ¨ä»ç±»åæ¨å¯¼
class CatalogModule(BentoModule):
    # name = "catalog"  # è‡ªåŠ¨æ¨å¯¼ï¼Œæ— éœ€æ˜¾å¼è®¾ç½®
    pass

# è·¯ç”±è‡ªåŠ¨æ³¨å†Œ
class CatalogModule(BentoModule):
    def get_routers(self):
        return [router]  # è‡ªåŠ¨æ³¨å†Œåˆ° FastAPI
```

---

## ğŸ¯ Runtime çš„å…¸å‹ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: ç®€å•çš„ CRUD API

```python
# æœ€ç®€å•çš„åº”ç”¨
runtime = (
    RuntimeBuilder()
    .with_database(url="sqlite:///app.db")
    .with_modules(InfraModule(), ProductModule())
    .build_runtime()
)

app = runtime.create_fastapi_app(title="Product API")
```

**ç‰¹ç‚¹**:
- å¿«é€Ÿå¯åŠ¨
- æœ€å°åŒ–é…ç½®
- é€‚åˆåŸå‹å¼€å‘

---

### åœºæ™¯ 2: ä¸­ç­‰è§„æ¨¡çš„å¾®æœåŠ¡

```python
# å¤šæ¨¡å—åº”ç”¨
runtime = (
    RuntimeBuilder()
    .with_config(service_name="order-service", environment="prod")
    .with_database(url=settings.database_url)
    .with_contracts("./contracts", require=True)
    .with_modules(
        InfraModule(),
        CatalogModule(),
        OrderingModule(),
        PaymentModule(),
    )
    .build_runtime()
)

app = runtime.create_fastapi_app(title="Order Service")
```

**ç‰¹ç‚¹**:
- å¤šä¸ªç‹¬ç«‹æ¨¡å—
- æ¸…æ™°çš„ä¾èµ–å…³ç³»
- å¥‘çº¦éªŒè¯

---

### åœºæ™¯ 3: é«˜æ€§èƒ½åº”ç”¨

```python
# é«˜æ€§èƒ½é…ç½®
from bento.messaging.event_bus import InMemoryEventBus

runtime = (
    RuntimeBuilder()
    .with_config(service_name="high-perf-app", environment="prod")
    .with_database(url=settings.database_url)
    .with_event_bus(InMemoryEventBus())  # åŒå‘å¸ƒç­–ç•¥
    .with_modules(...)
    .with_otel_tracing(service_name="high-perf-app")
    .build_runtime()
)

app = runtime.create_fastapi_app(title="High Performance API")
```

**ç‰¹ç‚¹**:
- æ€§èƒ½ä¼˜åŒ–ï¼ˆåŒå‘å¸ƒç­–ç•¥ï¼‰
- å¯è§‚æµ‹æ€§ï¼ˆOpenTelemetryï¼‰
- ç”Ÿäº§çº§é…ç½®

---

## ğŸ“Š Runtime ä¸å…¶ä»–æ¡†æ¶çš„å¯¹æ¯”

| ç‰¹æ€§ | FastAPI | Django | Bento Runtime |
|------|---------|--------|---------------|
| **æ¨¡å—ç³»ç»Ÿ** | âŒ | âœ… | âœ… |
| **DI å®¹å™¨** | âš ï¸ (Depends) | âŒ | âœ… |
| **ç”Ÿå‘½å‘¨æœŸç®¡ç†** | âš ï¸ (lifespan) | âœ… | âœ… |
| **æ•°æ®åº“ç®¡ç†** | âŒ | âœ… | âœ… |
| **å¥‘çº¦éªŒè¯** | âŒ | âŒ | âœ… |
| **å¯è§‚æµ‹æ€§** | âŒ | âš ï¸ | âœ… |
| **å­¦ä¹ æ›²çº¿** | ä½ | ä¸­ | ä½ |
| **çµæ´»æ€§** | é«˜ | ä¸­ | é«˜ |

---

## âœ… Runtime çš„æ ¸å¿ƒä»·å€¼

### 1. **ç»Ÿä¸€çš„å¯åŠ¨æµç¨‹**

```python
# ä¸€è¡Œä»£ç å¯åŠ¨æ•´ä¸ªåº”ç”¨
app = runtime.create_fastapi_app()
```

**vs æ‰‹åŠ¨é…ç½®**:
```python
# æ‰‹åŠ¨é…ç½®éœ€è¦ 50+ è¡Œä»£ç 
app = FastAPI()
app.add_middleware(...)
app.add_exception_handler(...)
# ... æ›´å¤šé…ç½®
```

---

### 2. **æ¨¡å—åŒ–æ¶æ„**

```python
# æ¸…æ™°çš„æ¨¡å—åˆ’åˆ†
modules = [InfraModule(), CatalogModule(), OrderingModule()]
```

**vs å•ä½“åº”ç”¨**:
```python
# æ‰€æœ‰ä»£ç æ··åœ¨ä¸€èµ·ï¼Œéš¾ä»¥ç»´æŠ¤
```

---

### 3. **è‡ªåŠ¨ä¾èµ–ç®¡ç†**

```python
# è‡ªåŠ¨æ‹“æ‰‘æ’åºå’Œåˆå§‹åŒ–
class OrderingModule(BentoModule):
    requires = ["infra", "catalog"]  # è‡ªåŠ¨æŒ‰é¡ºåºåˆå§‹åŒ–
```

**vs æ‰‹åŠ¨ç®¡ç†**:
```python
# æ‰‹åŠ¨ç®¡ç†ä¾èµ–é¡ºåºï¼Œå®¹æ˜“å‡ºé”™
```

---

### 4. **ç”Ÿäº§çº§åŠŸèƒ½**

```python
# å¼€ç®±å³ç”¨çš„ç”Ÿäº§çº§åŠŸèƒ½
- å¥‘çº¦éªŒè¯
- æ€§èƒ½ç›‘æ§
- å¯è§‚æµ‹æ€§ï¼ˆOpenTelemetryï¼‰
- çƒ­é‡è½½
- æµ‹è¯•æ”¯æŒ
```

---

## ğŸš€ æ€»ç»“

### Runtime çš„ 7 å¤§ä¸»è¦ç”¨é€”

1. **åº”ç”¨å¯åŠ¨å’Œåˆå§‹åŒ–** - ç»Ÿä¸€çš„å¯åŠ¨æµç¨‹
2. **æ¨¡å—ç³»ç»Ÿå’Œä¾èµ–ç®¡ç†** - ä»£ç æ¨¡å—åŒ–
3. **ä¾èµ–æ³¨å…¥å®¹å™¨** - æœåŠ¡ç®¡ç†
4. **FastAPI é›†æˆ** - è‡ªåŠ¨åŒ– FastAPI é…ç½®
5. **æ•°æ®åº“ç®¡ç†** - æ•°æ®åº“è¿æ¥ç®¡ç†
6. **å¥‘çº¦éªŒè¯** - æ¶æ„éªŒè¯
7. **å¯è§‚æµ‹æ€§** - æ€§èƒ½ç›‘æ§å’Œè¿½è¸ª

### æ ¸å¿ƒå®šä½

**Bento Runtime æ˜¯ä¸€ä¸ªåº”ç”¨å¯åŠ¨å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†æ¡†æ¶**

å®ƒæä¾›äº†ï¼š
- âœ… ç»Ÿä¸€çš„åº”ç”¨å¯åŠ¨ API
- âœ… æ¨¡å—åŒ–çš„ä»£ç ç»„ç»‡
- âœ… è‡ªåŠ¨çš„ä¾èµ–ç®¡ç†
- âœ… ç”Ÿäº§çº§çš„åŠŸèƒ½
- âœ… æœ€å°åŒ–çš„å­¦ä¹ æ›²çº¿

### é€‚ç”¨åœºæ™¯

- âœ… FastAPI åº”ç”¨
- âœ… å¾®æœåŠ¡æ¶æ„
- âœ… æ¨¡å—åŒ–åº”ç”¨
- âœ… ç”Ÿäº§çº§åº”ç”¨
- âœ… éœ€è¦ DDD çš„åº”ç”¨

### ä¸é€‚ç”¨åœºæ™¯

- âŒ ç®€å•çš„è„šæœ¬
- âŒ é FastAPI æ¡†æ¶
- âŒ ä¸éœ€è¦æ¨¡å—åŒ–çš„å°åº”ç”¨

---

## ğŸ“ˆ è®¾è®¡è¯„åˆ†

| ç»´åº¦ | è¯„åˆ† | è¯´æ˜ |
|------|------|------|
| **æ˜“ç”¨æ€§** | â­â­â­â­â­ | å¼€ç®±å³ç”¨ï¼Œå­¦ä¹ æ›²çº¿ä½ |
| **çµæ´»æ€§** | â­â­â­â­â­ | æ”¯æŒå¤šç§é…ç½®æ–¹å¼ |
| **å¯ç»´æŠ¤æ€§** | â­â­â­â­â­ | æ¨¡å—åŒ–ï¼Œä»£ç æ¸…æ™° |
| **å¯æ‰©å±•æ€§** | â­â­â­â­â­ | æ”¯æŒæ’ä»¶å’Œçƒ­é‡è½½ |
| **æ€§èƒ½** | â­â­â­â­ | è½»é‡çº§ï¼Œå¼€é”€å° |
| **æ–‡æ¡£** | â­â­â­â­ | æ–‡æ¡£å®Œæ•´ï¼Œç¤ºä¾‹ä¸°å¯Œ |

**æ€»ä½“è¯„åˆ†**: â­â­â­â­â­ (5.0/5)

---

## ğŸ“ å­¦ä¹ è·¯å¾„

### åˆçº§ï¼ˆäº†è§£åŸºç¡€ï¼‰
1. ç†è§£ Runtime çš„æ ¸å¿ƒæ¦‚å¿µ
2. å­¦ä¼šåˆ›å»ºç®€å•çš„æ¨¡å—
3. ä½¿ç”¨ RuntimeBuilder å¯åŠ¨åº”ç”¨

### ä¸­çº§ï¼ˆå®é™…åº”ç”¨ï¼‰
1. è®¾è®¡å¤šæ¨¡å—åº”ç”¨
2. ä½¿ç”¨ DI å®¹å™¨ç®¡ç†æœåŠ¡
3. é…ç½®æ•°æ®åº“å’Œç¼“å­˜

### é«˜çº§ï¼ˆä¼˜åŒ–å’Œæ‰©å±•ï¼‰
1. æ€§èƒ½ä¼˜åŒ–ï¼ˆåŒå‘å¸ƒç­–ç•¥ï¼‰
2. å¯è§‚æµ‹æ€§é…ç½®ï¼ˆOpenTelemetryï¼‰
3. å¥‘çº¦éªŒè¯å’Œæ¶æ„æ²»ç†
4. çƒ­é‡è½½å’ŒåŠ¨æ€æ¨¡å—åŠ è½½

---

## ç»“è®º

**Bento Runtime æ˜¯ä¸€ä¸ªè®¾è®¡ç²¾è‰¯çš„åº”ç”¨å¯åŠ¨æ¡†æ¶**

å®ƒé€šè¿‡ç»Ÿä¸€çš„ API æä¾›äº†ï¼š
- æ¨¡å—åŒ–çš„ä»£ç ç»„ç»‡
- è‡ªåŠ¨çš„ä¾èµ–ç®¡ç†
- ç”Ÿäº§çº§çš„åŠŸèƒ½
- æœ€å°åŒ–çš„å­¦ä¹ æ›²çº¿

**æ¨èç”¨äº**:
- âœ… æ‰€æœ‰ FastAPI åº”ç”¨
- âœ… éœ€è¦æ¨¡å—åŒ–çš„åº”ç”¨
- âœ… ç”Ÿäº§çº§åº”ç”¨
- âœ… å¾®æœåŠ¡æ¶æ„

**å½“å‰ Runtime çš„è®¾è®¡æ˜¯å®Œå…¨æ­£ç¡®çš„** âœ…

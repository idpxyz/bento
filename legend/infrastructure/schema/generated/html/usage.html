<!DOCTYPE html>

<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Schema Center ä½¿ç”¨æŒ‡å— - IDP Schema Center</title>
<style>
        :root {
            --primary-color: #4285f4;
            --text-color: #333;
            --bg-color: #fff;
            --header-bg: #4285f4;
            --sidebar-bg: #f5f5f5;
            --border-color: #e0e0e0;
            --code-bg: rgba(27, 31, 35, 0.05);
            --pre-bg: #f6f8fa;
            --sidebar-width: 280px;
            --toc-width: 240px;
            --header-height: 60px;
            --font-sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            --font-mono: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
        }
        
        [data-theme="dark"] {
            --primary-color: #64b5f6;
            --text-color: #e0e0e0;
            --bg-color: #121212;
            --header-bg: #1a1a1a;
            --sidebar-bg: #1e1e1e;
            --border-color: #333;
            --code-bg: rgba(240, 246, 252, 0.15);
            --pre-bg: #282c34;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: var(--font-sans);
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
            transition: background-color 0.3s ease;
        }
        
        header {
            height: var(--header-height);
            background-color: var(--header-bg);
            color: white;
            display: flex;
            align-items: center;
            padding: 0 20px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s ease;
        }
        
        .logo {
            font-weight: bold;
            font-size: 1.25rem;
            margin-right: 20px;
        }
        
        .main-container {
            display: flex;
            height: calc(100vh - var(--header-height));
            margin-top: var(--header-height);
        }
        
        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--sidebar-bg);
            overflow-y: auto;
            border-right: 1px solid var(--border-color);
            padding: 20px;
            flex-shrink: 0;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        
        .content-container {
            flex: 1;
            overflow: hidden;
            display: flex;
        }
        
        .content {
            flex-grow: 1;
            width: 0;
            overflow-y: auto;
            padding: 40px;
            margin: 0 auto;
        }
        
        .toc {
            width: var(--toc-width);
            padding: 20px;
            border-left: 1px solid var(--border-color);
            flex-shrink: 0;
            overflow-y: auto;
            transition: border-color 0.3s ease;
        }
        
        h1, h2, h3, h4, h5, h6 {
            margin-top: 1.5em;
            margin-bottom: 0.5em;
            font-weight: 600;
            line-height: 1.25;
        }
        
        h1 {
            font-size: 2em;
            padding-bottom: 0.3em;
            border-bottom: 1px solid var(--border-color);
            margin-top: 0;
            transition: border-color 0.3s ease;
        }
        
        h2 {
            font-size: 1.5em;
            padding-bottom: 0.3em;
            border-bottom: 1px solid var(--border-color);
            transition: border-color 0.3s ease;
        }
        
        h3 {
            font-size: 1.25em;
        }
        
        p, ul, ol {
            margin-bottom: 16px;
        }
        
        a {
            color: var(--primary-color);
            text-decoration: none;
        }
        
        a:hover {
            text-decoration: underline;
        }
        
        code {
            font-family: var(--font-mono);
            background-color: var(--code-bg);
            padding: 0.2em 0.4em;
            border-radius: 3px;
            font-size: 85%;
            transition: background-color 0.3s ease;
        }
        
        pre {
            background-color: var(--pre-bg);
            border-radius: 3px;
            padding: 16px;
            overflow: auto;
            margin-bottom: 16px;
            transition: background-color 0.3s ease;
        }
        
        pre code {
            background-color: transparent;
            padding: 0;
            margin: 0;
            font-size: 90%;
            word-break: normal;
            white-space: pre;
            overflow: visible;
            line-height: inherit;
        }
        
        table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 16px;
        }
        
        table th, table td {
            padding: 6px 13px;
            border: 1px solid var(--border-color);
            transition: border-color 0.3s ease;
        }
        
        table th {
            background-color: var(--pre-bg);
            font-weight: 600;
            transition: background-color 0.3s ease;
        }
        
        table tr:nth-child(2n) {
            background-color: var(--pre-bg);
            transition: background-color 0.3s ease;
        }
        
        img {
            max-width: 100%;
        }
        
        blockquote {
            padding: 0 1em;
            color: #6a737d;
            border-left: 0.25em solid var(--border-color);
            margin-bottom: 16px;
            transition: border-color 0.3s ease;
        }
        
        hr {
            height: 0.25em;
            padding: 0;
            margin: 24px 0;
            background-color: var(--border-color);
            border: 0;
            transition: background-color 0.3s ease;
        }
        
        .nav-list {
            list-style: none;
        }
        
        .nav-list li {
            margin-bottom: 8px;
        }
        
        .nav-list li a {
            display: block;
            padding: 4px 0;
        }
        
        .nav-category {
            margin-top: 16px;
            font-weight: bold;
            color: var(--text-color);
            transition: color 0.3s ease;
        }
        
        .search-box {
            margin-bottom: 20px;
        }
        
        .search-box input {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
        
        @media (max-width: 1200px) {
            .toc {
                display: none;
            }
        }
        
        @media (max-width: 900px) {
            .sidebar {
                width: 240px;
            }
        }
        
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
        }
        
        /* ä¸»é¢˜åˆ‡æ¢ */
        .theme-toggle {
            cursor: pointer;
            margin-left: auto;
            padding: 8px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s ease;
        }
        
        .theme-toggle:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        /* é“¾æ¥æ ·å¼ä¼˜åŒ– */
        .content a:not(:hover) {
            text-decoration: none;
            border-bottom: 1px solid rgba(66, 133, 244, 0.3);
        }
        
        .content a:hover {
            border-bottom-color: var(--primary-color);
        }
        
        /* ä»£ç é«˜äº® */
        .codehilite {
            background: var(--pre-bg);
            border-radius: 4px;
            transition: background-color 0.3s ease;
        }
        
        .codehilite pre {
            padding: 1em;
            margin: 0;
            overflow: auto;
        }

        /* Center - å±…ä¸­ */
        div[align="center"] {
            text-align: center;
            margin: 1.5em 0;
        }
        
        /* ç›®å½•é¡¹ç›®æ ·å¼ */
        .toc ul {
            list-style: none;
            padding-left: 1em;
        }
        
        .toc > ul {
            padding-left: 0;
        }
        
        .toc li {
            margin-bottom: 0.5em;
        }
        
        .toc-title {
            font-weight: bold;
            margin-bottom: 1em;
        }
    </style>
</head>
<body>
<header>
<div class="logo">IDP Schema Center</div>
<nav>
<a href="index.html" style="color: white; margin-right: 15px;">é¦–é¡µ</a>
<a href="usage.html" style="color: white; margin-right: 15px;">ä½¿ç”¨æŒ‡å—</a>
<a href="proto.html" style="color: white; margin-right: 15px;">Proto</a>
<a href="avro.html" style="color: white; margin-right: 15px;">Avro</a>
<a href="json.html" style="color: white; margin-right: 15px;">JSON</a>
</nav>
<div class="theme-toggle" id="theme-toggle">ğŸ”†</div>
</header>
<div class="main-container">
<aside class="sidebar">
<div class="search-box">
<input id="search-input" placeholder="æœç´¢..." type="text"/>
</div>
<div class="nav-category">æ–‡æ¡£</div>
<ul class="nav-list">
<li><a href="index.html">é¦–é¡µ</a></li>
<li><a href="usage.html">ä½¿ç”¨æŒ‡å—</a></li>
<li><a href="proto.html">Proto äº‹ä»¶</a></li>
<li><a href="avro.html">Avro äº‹ä»¶</a></li>
<li><a href="json.html">JSON äº‹ä»¶</a></li>
</ul>
<div class="nav-category">æŒ‡å—</div>
<ul class="nav-list guides-list">
<li><a href="event_bus_integration.html">Event Bus é›†æˆ</a></li>
<li><a href="registry.html">Registry</a></li>
<li><a href="usage.html">ä½¿ç”¨æŒ‡å—</a></li>
</ul>
<div class="nav-category">Schema åˆ—è¡¨</div>
<ul class="nav-list schema-list">
<li><a href="ordercreated.html">OrderCreated</a></li>
<li><a href="ordercreatedv2.html">OrderCreatedV2</a></li>
<li><a href="paymentprocessed.html">PaymentProcessed</a></li>
<li><a href="productadded.html">ProductAdded</a></li>
<li><a href="productupdated.html">ProductUpdated</a></li>
<li><a href="useractivity.html">UserActivity</a></li>
<li><a href="userregistered.html">UserRegistered</a></li>
</ul>
</aside>
<div class="content-container">
<main class="content">
<h1>Schema Center ä½¿ç”¨æŒ‡å—</h1>
<div align="center">
<h3>è§„èŒƒåŒ–çš„äº‹ä»¶æ¨¡å¼ç®¡ç†ä¸ä»£ç ç”Ÿæˆå·¥å…·</h3>
<p>ç®€åŒ–æ•°æ®æµè½¬ï¼Œä¿éšœå„ç³»ç»Ÿé—´ä¿¡æ¯äº¤æ¢çš„ä¸€è‡´æ€§ä¸å¯é æ€§</p>
</div>
<h2>ğŸ“‹ ç›®å½•</h2>
<ul>
<li><a href="#ç®€ä»‹">ç®€ä»‹</a></li>
<li><a href="#å¿«é€Ÿå¼€å§‹">å¿«é€Ÿå¼€å§‹</a></li>
<li><a href="#æ ¸å¿ƒåŠŸèƒ½">æ ¸å¿ƒåŠŸèƒ½</a></li>
<li><a href="#schema-å®šä¹‰ä¸ç®¡ç†">Schema å®šä¹‰ä¸ç®¡ç†</a></li>
<li><a href="#æ¨¡å‹ä»£ç ç”Ÿæˆ">æ¨¡å‹ä»£ç ç”Ÿæˆ</a></li>
<li><a href="#schema-ç‰ˆæœ¬æ§åˆ¶">Schema ç‰ˆæœ¬æ§åˆ¶</a></li>
<li><a href="#å…¼å®¹æ€§éªŒè¯">å…¼å®¹æ€§éªŒè¯</a></li>
<li><a href="#å¼€å‘å·¥ä½œæµ">å¼€å‘å·¥ä½œæµ</a></li>
<li><a href="#api-å‚è€ƒ">API å‚è€ƒ</a></li>
<li><a href="#æœ€ä½³å®è·µ">æœ€ä½³å®è·µ</a></li>
<li><a href="#å¸¸è§é—®é¢˜">å¸¸è§é—®é¢˜</a></li>
</ul>
<h2>ç®€ä»‹</h2>
<p>Schema Center æ˜¯ä¸€ä¸ªå¼ºå¤§çš„äº‹ä»¶æ¨¡å¼ç®¡ç†æ¡†æ¶ï¼Œä¸ºäº‹ä»¶é©±åŠ¨æ¶æ„æä¾›æ ¸å¿ƒæ”¯æŒã€‚å®ƒå…è®¸å¼€å‘å›¢é˜Ÿé›†ä¸­å®šä¹‰ã€ç®¡ç†å’Œæ¼”è¿›æ•°æ®æ¨¡å¼ï¼Œç¡®ä¿è·¨ç³»ç»Ÿé€šä¿¡çš„ä¸€è‡´æ€§å’Œå¯é æ€§ã€‚</p>
<p>ä¸»è¦ç‰¹æ€§ï¼š</p>
<ul>
<li><strong>å¤šæ ¼å¼æ”¯æŒ</strong>ï¼šåŸç”Ÿæ”¯æŒ Protocol Buffersã€Avro å’Œ JSON Schema</li>
<li><strong>ä»£ç ç”Ÿæˆ</strong>ï¼šè‡ªåŠ¨å°† Schema è½¬æ¢ä¸ºå¯ç›´æ¥ä½¿ç”¨çš„ Pydantic æ¨¡å‹</li>
<li><strong>ç‰ˆæœ¬æ§åˆ¶</strong>ï¼šå†…ç½® Schema ç‰ˆæœ¬ç®¡ç†æœºåˆ¶</li>
<li><strong>å…¼å®¹æ€§æ£€æŸ¥</strong>ï¼šç¡®ä¿ä¸åŒç‰ˆæœ¬ Schema é—´çš„å…¼å®¹æ€§</li>
<li><strong>æ–‡æ¡£ç”Ÿæˆ</strong>ï¼šè‡ªåŠ¨ç”Ÿæˆå¯è§†åŒ–æ–‡æ¡£</li>
</ul>
<h2>å¿«é€Ÿå¼€å§‹</h2>
<h3>å®‰è£…ä¾èµ–</h3>
<p>ç¡®ä¿å·²å®‰è£…æ‰€æœ‰å¿…è¦ä¾èµ–ï¼š</p>
<div class="codehilite"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>pydantic<span class="w"> </span>avro-python3<span class="w"> </span>protobuf<span class="w"> </span>jsonschema
</code></pre></div>
<h3>åˆ›å»ºç¬¬ä¸€ä¸ª Schema</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># åˆ›å»ºä¸€ä¸ªåŸºäº Protocol Buffers çš„äº‹ä»¶ Schema</span>
make<span class="w"> </span>create<span class="w"> </span><span class="nv">NAME</span><span class="o">=</span>OrderCreated<span class="w"> </span><span class="nv">FORMAT</span><span class="o">=</span>proto<span class="w"> </span><span class="nv">DESC</span><span class="o">=</span><span class="s2">"è®¢å•åˆ›å»ºäº‹ä»¶"</span>

<span class="c1"># ç¼–è¾‘ Schema å®šä¹‰</span>
vim<span class="w"> </span>schemas/ordercreated/order_created.proto
</code></pre></div>
<p>ç¤ºä¾‹ Proto æ–‡ä»¶å†…å®¹ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">syntax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"proto3"</span><span class="p">;</span>

<span class="kn">package</span><span class="w"> </span><span class="nn">ecommerce</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="s">"google/protobuf/timestamp.proto"</span><span class="p">;</span>

<span class="c1">// è®¢å•åˆ›å»ºäº‹ä»¶</span>
<span class="kd">message</span><span class="w"> </span><span class="nc">OrderCreated</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="na">order_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">                        </span><span class="c1">// è®¢å•ID</span>
<span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="na">customer_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w">                     </span><span class="c1">// å®¢æˆ·ID</span>
<span class="w">    </span><span class="k">repeated</span><span class="w"> </span><span class="n">OrderItem</span><span class="w"> </span><span class="na">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w">               </span><span class="c1">// è®¢å•é¡¹ç›®</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="na">total_amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w">                    </span><span class="c1">// æ€»é‡‘é¢</span>
<span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="na">currency</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w">                        </span><span class="c1">// è´§å¸ä»£ç </span>
<span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span><span class="w">                          </span><span class="c1">// è®¢å•çŠ¶æ€ é€‰é¡¹: "pending", "paid", "cancelled"</span>
<span class="w">    </span><span class="n">google.protobuf.Timestamp</span><span class="w"> </span><span class="na">created_at</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span><span class="w">   </span><span class="c1">// åˆ›å»ºæ—¶é—´</span>
<span class="p">}</span>

<span class="c1">// è®¢å•é¡¹ç›®</span>
<span class="kd">message</span><span class="w"> </span><span class="nc">OrderItem</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="na">product_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">                      </span><span class="c1">// äº§å“ID</span>
<span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="na">product_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w">                    </span><span class="c1">// äº§å“åç§°</span>
<span class="w">    </span><span class="kt">int32</span><span class="w"> </span><span class="na">quantity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w">                         </span><span class="c1">// æ•°é‡</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="na">unit_price</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w">                      </span><span class="c1">// å•ä»·</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="na">subtotal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w">                        </span><span class="c1">// å°è®¡</span>
<span class="p">}</span>
</code></pre></div>
<h3>ç”Ÿæˆ Pydantic æ¨¡å‹</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># ç”Ÿæˆç‰¹å®š Schema çš„ Pydantic æ¨¡å‹</span>
make<span class="w"> </span>generate<span class="w"> </span><span class="nv">NAME</span><span class="o">=</span>OrderCreated

<span class="c1"># æˆ–ç”Ÿæˆæ‰€æœ‰ Schema çš„æ¨¡å‹</span>
make<span class="w"> </span>generate
</code></pre></div>
<h3>åœ¨åº”ç”¨ä¸­ä½¿ç”¨ç”Ÿæˆçš„æ¨¡å‹</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.idp.framework.infrastructure.schema.generated.models.ordercreated</span><span class="w"> </span><span class="kn">import</span> <span class="n">OrderCreated</span><span class="p">,</span> <span class="n">OrderItem</span>

<span class="c1"># åˆ›å»ºè®¢å•é¡¹ç›®</span>
<span class="n">items</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">OrderItem</span><span class="p">(</span>
        <span class="n">product_id</span><span class="o">=</span><span class="s2">"PROD-123"</span><span class="p">,</span>
        <span class="n">product_name</span><span class="o">=</span><span class="s2">"æ™ºèƒ½æ‰‹æœº"</span><span class="p">,</span>
        <span class="n">quantity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">unit_price</span><span class="o">=</span><span class="mf">999.99</span><span class="p">,</span>
        <span class="n">subtotal</span><span class="o">=</span><span class="mf">999.99</span>
    <span class="p">),</span>
    <span class="n">OrderItem</span><span class="p">(</span>
        <span class="n">product_id</span><span class="o">=</span><span class="s2">"PROD-456"</span><span class="p">,</span>
        <span class="n">product_name</span><span class="o">=</span><span class="s2">"ä¿æŠ¤å£³"</span><span class="p">,</span>
        <span class="n">quantity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">unit_price</span><span class="o">=</span><span class="mf">29.99</span><span class="p">,</span>
        <span class="n">subtotal</span><span class="o">=</span><span class="mf">59.98</span>
    <span class="p">)</span>
<span class="p">]</span>

<span class="c1"># åˆ›å»ºè®¢å•äº‹ä»¶</span>
<span class="n">order</span> <span class="o">=</span> <span class="n">OrderCreated</span><span class="p">(</span>
    <span class="n">order_id</span><span class="o">=</span><span class="s2">"ORD-789"</span><span class="p">,</span>
    <span class="n">customer_id</span><span class="o">=</span><span class="s2">"CUST-123"</span><span class="p">,</span>
    <span class="n">items</span><span class="o">=</span><span class="n">items</span><span class="p">,</span>
    <span class="n">total_amount</span><span class="o">=</span><span class="mf">1059.97</span><span class="p">,</span>
    <span class="n">currency</span><span class="o">=</span><span class="s2">"CNY"</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">"paid"</span><span class="p">,</span>
    <span class="n">created_at</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="p">)</span>

<span class="c1"># åºåˆ—åŒ–ä¸º JSON</span>
<span class="n">order_json</span> <span class="o">=</span> <span class="n">order</span><span class="o">.</span><span class="n">model_dump_json</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">order_json</span><span class="p">)</span>

<span class="c1"># ååºåˆ—åŒ–</span>
<span class="n">received_order</span> <span class="o">=</span> <span class="n">OrderCreated</span><span class="o">.</span><span class="n">model_validate_json</span><span class="p">(</span><span class="n">order_json</span><span class="p">)</span>
</code></pre></div>
<h2>æ ¸å¿ƒåŠŸèƒ½</h2>
<h3>Schema å®šä¹‰ä¸ç®¡ç†</h3>
<p>Schema Center æ”¯æŒä¸‰ç§ä¸»æµæ•°æ®æ¨¡å¼æ ¼å¼ï¼š</p>
<h4>Protocol Buffers</h4>
<p>é€‚ç”¨äºéœ€è¦é«˜æ€§èƒ½åºåˆ—åŒ–å’Œä¸¥æ ¼ç±»å‹å®šä¹‰çš„åœºæ™¯ã€‚</p>
<div class="codehilite"><pre><span></span><code>make<span class="w"> </span>create<span class="w"> </span><span class="nv">NAME</span><span class="o">=</span>UserRegistered<span class="w"> </span><span class="nv">FORMAT</span><span class="o">=</span>proto<span class="w"> </span><span class="nv">DESC</span><span class="o">=</span><span class="s2">"ç”¨æˆ·æ³¨å†Œäº‹ä»¶"</span>
</code></pre></div>
<h4>Apache Avro</h4>
<p>é€‚ç”¨äºå¤æ‚æ•°æ®ç»“æ„å’Œå…¼å®¹æ€§è¦æ±‚é«˜çš„åœºæ™¯ã€‚</p>
<div class="codehilite"><pre><span></span><code>make<span class="w"> </span>create<span class="w"> </span><span class="nv">NAME</span><span class="o">=</span>ProductInventory<span class="w"> </span><span class="nv">FORMAT</span><span class="o">=</span>avro<span class="w"> </span><span class="nv">DESC</span><span class="o">=</span><span class="s2">"äº§å“åº“å­˜äº‹ä»¶"</span>
</code></pre></div>
<h4>JSON Schema</h4>
<p>é€‚ç”¨äºä¸ Web API é›†æˆå’ŒéªŒè¯ JSON æ•°æ®çš„åœºæ™¯ã€‚</p>
<div class="codehilite"><pre><span></span><code>make<span class="w"> </span>create<span class="w"> </span><span class="nv">NAME</span><span class="o">=</span>UserActivity<span class="w"> </span><span class="nv">FORMAT</span><span class="o">=</span>json<span class="w"> </span><span class="nv">DESC</span><span class="o">=</span><span class="s2">"ç”¨æˆ·æ´»åŠ¨äº‹ä»¶"</span>
</code></pre></div>
<h3>æ¨¡å‹ä»£ç ç”Ÿæˆ</h3>
<p>è‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„ Pydantic æ¨¡å‹ï¼Œåˆ©ç”¨ Python ç±»å‹ç³»ç»Ÿè¿›è¡ŒéªŒè¯å’Œåºåˆ—åŒ–ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># ç”Ÿæˆå•ä¸ª Schema çš„æ¨¡å‹</span>
make<span class="w"> </span>generate<span class="w"> </span><span class="nv">NAME</span><span class="o">=</span>OrderCreated

<span class="c1"># ç”Ÿæˆå…¨éƒ¨æ¨¡å‹</span>
make<span class="w"> </span>generate

<span class="c1"># ä½¿ç”¨ç”Ÿæˆçš„æ¨¡å‹è¿›è¡ŒéªŒè¯å’Œåºåˆ—åŒ–</span>
from<span class="w"> </span>src.idp.framework.infrastructure.schema.generated.models.ordercreated<span class="w"> </span>import<span class="w"> </span>OrderCreated

<span class="c1"># ä»æ•°æ®åˆ›å»ºæ¨¡å‹ï¼ˆè‡ªåŠ¨éªŒè¯ï¼‰</span>
<span class="nv">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>OrderCreated<span class="o">(</span>**data<span class="o">)</span>

<span class="c1"># åºåˆ—åŒ–ä¸º JSON</span>
<span class="nv">json_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>order.model_dump_json<span class="o">()</span>

<span class="c1"># æˆ–è½¬æ¢ä¸ºå­—å…¸</span>
<span class="nv">dict_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>order.model_dump<span class="o">()</span>
</code></pre></div>
<h3>Schema ç‰ˆæœ¬æ§åˆ¶</h3>
<p>ç®¡ç† Schema çš„æ¼”è¿›ï¼Œå…è®¸å¤šä¸ªç‰ˆæœ¬å¹¶å­˜ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># åˆ›å»º Schema çš„æ–°ç‰ˆæœ¬</span>
make<span class="w"> </span>version-new<span class="w"> </span><span class="nv">NAME</span><span class="o">=</span>OrderCreated<span class="w"> </span><span class="nv">VERSION</span><span class="o">=</span><span class="m">2</span>

<span class="c1"># åˆ—å‡ºç‰¹å®š Schema çš„æ‰€æœ‰ç‰ˆæœ¬</span>
make<span class="w"> </span>version-list<span class="w"> </span><span class="nv">NAME</span><span class="o">=</span>OrderCreated
</code></pre></div>
<h3>å…¼å®¹æ€§éªŒè¯</h3>
<p>ç¡®ä¿ Schema å˜æ›´ä¸ä¼šç ´åç°æœ‰ç³»ç»Ÿã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># éªŒè¯å‘åå…¼å®¹æ€§ï¼ˆæ–°ç‰ˆæœ¬å¯è¯»å–æ—§æ•°æ®ï¼‰</span>
make<span class="w"> </span>verify-compatibility<span class="w"> </span><span class="nv">NAME</span><span class="o">=</span>OrderCreated<span class="w"> </span><span class="nv">VERSION</span><span class="o">=</span><span class="m">2</span><span class="w"> </span><span class="nv">MODE</span><span class="o">=</span>BACKWARD

<span class="c1"># éªŒè¯å‘å‰å…¼å®¹æ€§ï¼ˆæ—§ç‰ˆæœ¬å¯è¯»å–æ–°æ•°æ®ï¼‰</span>
make<span class="w"> </span>verify-compatibility<span class="w"> </span><span class="nv">NAME</span><span class="o">=</span>OrderCreated<span class="w"> </span><span class="nv">VERSION</span><span class="o">=</span><span class="m">2</span><span class="w"> </span><span class="nv">MODE</span><span class="o">=</span>FORWARD

<span class="c1"># éªŒè¯å®Œå…¨å…¼å®¹æ€§ï¼ˆåŒå‘å…¼å®¹ï¼‰</span>
make<span class="w"> </span>verify-compatibility<span class="w"> </span><span class="nv">NAME</span><span class="o">=</span>OrderCreated<span class="w"> </span><span class="nv">VERSION</span><span class="o">=</span><span class="m">2</span><span class="w"> </span><span class="nv">MODE</span><span class="o">=</span>FULL
</code></pre></div>
<p>æ”¯æŒçš„å…¼å®¹æ€§æ¨¡å¼ï¼š</p>
<ul>
<li><strong>BACKWARD</strong>ï¼šæ–°ç‰ˆæœ¬å¯ä»¥è¯»å–æ—§ç‰ˆæœ¬çš„æ•°æ®</li>
<li><strong>FORWARD</strong>ï¼šæ—§ç‰ˆæœ¬å¯ä»¥è¯»å–æ–°ç‰ˆæœ¬çš„æ•°æ®</li>
<li><strong>FULL</strong>ï¼šå®Œå…¨å…¼å®¹ï¼ˆåŒæ—¶æ»¡è¶³å‘å‰å’Œå‘åå…¼å®¹ï¼‰</li>
<li><strong>NONE</strong>ï¼šä¸è¿›è¡Œå…¼å®¹æ€§æ£€æŸ¥</li>
</ul>
<h2>å¼€å‘å·¥ä½œæµ</h2>
<p>ä½¿ç”¨ Schema Center çš„å…¸å‹å¼€å‘æµç¨‹ï¼š</p>
<ol>
<li><strong>å®šä¹‰äº‹ä»¶æ¨¡å¼</strong>ï¼šä½¿ç”¨ <code>make create</code> åˆ›å»ºæ–°çš„ Schema å®šä¹‰</li>
<li><strong>ç”Ÿæˆæ¨¡å‹ä»£ç </strong>ï¼šä½¿ç”¨ <code>make generate</code> ç”Ÿæˆ Pydantic æ¨¡å‹</li>
<li><strong>åœ¨åº”ç”¨ä¸­ä½¿ç”¨</strong>ï¼šå¯¼å…¥ç”Ÿæˆçš„æ¨¡å‹ç”¨äºæ•°æ®éªŒè¯å’Œåºåˆ—åŒ–</li>
<li><strong>æ¼”è¿› Schema</strong>ï¼šä½¿ç”¨ <code>make version-new</code> åˆ›å»ºæ–°ç‰ˆæœ¬</li>
<li><strong>éªŒè¯å…¼å®¹æ€§</strong>ï¼šä½¿ç”¨ <code>make verify-compatibility</code> ç¡®ä¿å…¼å®¹æ€§</li>
<li><strong>ç”Ÿæˆæ–°ç‰ˆæœ¬æ¨¡å‹</strong>ï¼šä½¿ç”¨ <code>make generate</code> æ›´æ–°æ¨¡å‹ä»£ç </li>
</ol>
<h2>API å‚è€ƒ</h2>
<h3>æ ¸å¿ƒ API å‡½æ•°</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">src.idp.framework.infrastructure.schema</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_schema</span><span class="p">,</span> <span class="n">load_registry</span><span class="p">,</span> <span class="n">get_schema_topic</span>

<span class="c1"># åŠ è½½ Schema æ³¨å†Œè¡¨</span>
<span class="n">registry</span> <span class="o">=</span> <span class="n">load_registry</span><span class="p">()</span>

<span class="c1"># åŠ è½½ç‰¹å®š Schema å®šä¹‰</span>
<span class="n">order_schema</span> <span class="o">=</span> <span class="n">load_schema</span><span class="p">(</span><span class="s2">"OrderCreated"</span><span class="p">)</span>
<span class="c1"># åŠ è½½ç‰¹å®šç‰ˆæœ¬çš„ Schema</span>
<span class="n">order_schema_v2</span> <span class="o">=</span> <span class="n">load_schema</span><span class="p">(</span><span class="s2">"OrderCreated"</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># è·å– Schema å¯¹åº”çš„ä¸»é¢˜</span>
<span class="n">topic</span> <span class="o">=</span> <span class="n">get_schema_topic</span><span class="p">(</span><span class="s2">"OrderCreated"</span><span class="p">)</span>
</code></pre></div>
<h3>åœ¨äº‹ä»¶æ€»çº¿ä¸­é›†æˆ</h3>
<p>å‘å¸ƒäº‹ä»¶ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">src.idp.framework.infrastructure.schema.generated.models.ordercreated</span><span class="w"> </span><span class="kn">import</span> <span class="n">OrderCreated</span>

<span class="k">def</span><span class="w"> </span><span class="nf">publish_order_created</span><span class="p">(</span><span class="n">order_data</span><span class="p">):</span>
    <span class="c1"># åˆ›å»ºå¹¶éªŒè¯æ¨¡å‹</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">OrderCreated</span><span class="p">(</span><span class="o">**</span><span class="n">order_data</span><span class="p">)</span>

    <span class="c1"># å‘å¸ƒåˆ°äº‹ä»¶æ€»çº¿</span>
    <span class="n">event_bus</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span>
        <span class="n">topic</span><span class="o">=</span><span class="s2">"order.created"</span><span class="p">,</span>
        <span class="n">payload</span><span class="o">=</span><span class="n">order</span><span class="o">.</span><span class="n">model_dump_json</span><span class="p">(),</span>
        <span class="n">schema_name</span><span class="o">=</span><span class="s2">"OrderCreated"</span>
    <span class="p">)</span>
</code></pre></div>
<p>æ¶ˆè´¹äº‹ä»¶ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@event_bus</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">topic</span><span class="o">=</span><span class="s2">"order.created"</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="s2">"OrderCreated"</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">handle_order_created</span><span class="p">(</span><span class="n">event_data</span><span class="p">):</span>
    <span class="c1"># éªŒè¯å¹¶è½¬æ¢ä¸ºæ¨¡å‹</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">OrderCreated</span><span class="o">.</span><span class="n">model_validate_json</span><span class="p">(</span><span class="n">event_data</span><span class="p">)</span>

    <span class="c1"># å¤„ç†è®¢å•</span>
    <span class="k">await</span> <span class="n">process_order</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>
</code></pre></div>
<h2>æœ€ä½³å®è·µ</h2>
<h3>Schema è®¾è®¡åŸåˆ™</h3>
<ol>
<li><strong>å…·æœ‰æè¿°æ€§çš„å‘½å</strong>ï¼šä½¿ç”¨æ¸…æ™°ã€æè¿°æ€§çš„åç§°å‘½å Schema å’Œå­—æ®µ</li>
<li><strong>æ·»åŠ è¯¦ç»†æ³¨é‡Š</strong>ï¼šä¸ºæ¯ä¸ªå­—æ®µæ·»åŠ æ³¨é‡Šï¼Œè¯´æ˜å…¶ç”¨é€”å’Œçº¦æŸ</li>
<li><strong>ä¿æŒå‘åå…¼å®¹</strong>ï¼šæ·»åŠ æ–°å­—æ®µæ—¶è®¾ç½®åˆç†çš„é»˜è®¤å€¼ï¼Œé¿å…åˆ é™¤æˆ–é‡å‘½åå·²æœ‰å­—æ®µ</li>
<li><strong>ä½¿ç”¨æ˜ç¡®çš„ç±»å‹</strong>ï¼šæŒ‡å®šæœ€ç²¾ç¡®çš„ç±»å‹ï¼Œé¿å…è¿‡äºå®½æ¾çš„ç±»å‹å®šä¹‰</li>
<li><strong>åˆ†ç‰ˆæœ¬æ¼”è¿›</strong>ï¼šé€šè¿‡ç‰ˆæœ¬æ§åˆ¶æœºåˆ¶é€æ­¥æ¼”è¿› Schemaï¼Œè€Œä¸æ˜¯ç›´æ¥ä¿®æ”¹ç°æœ‰ç‰ˆæœ¬</li>
</ol>
<h3>æŒç»­é›†æˆå»ºè®®</h3>
<p>å°† Schema éªŒè¯æ•´åˆåˆ° CI/CD æµç¨‹ä¸­ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># CI æµç¨‹ç¤ºä¾‹</span>
<span class="nt">schema-validation</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">validate</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">make generate</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python -m unittest discover src/idp/framework/infrastructure/schema/cli/tests</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">make verify-compatibility NAME=OrderCreated VERSION=latest MODE=BACKWARD</span>
</code></pre></div>
<h2>å¸¸è§é—®é¢˜</h2>
<h3>Q: å¦‚ä½•å¤„ç† Schema çš„å¾ªç¯ä¾èµ–ï¼Ÿ</h3>
<p>A: å°½é‡é¿å…åœ¨ Schema è®¾è®¡ä¸­åˆ›å»ºå¾ªç¯ä¾èµ–ã€‚å¦‚æœç¡®å®éœ€è¦ï¼Œå¯ä»¥è€ƒè™‘å°†ç›¸å…³å®ä½“åˆ†æ‹†ä¸ºç‹¬ç«‹çš„ Schemaï¼Œæˆ–ä½¿ç”¨ä¸­é—´å±‚å°è£…å¤æ‚å…³ç³»ã€‚</p>
<h3>Q: Schema åº”è¯¥åŒ…å«å¤šå°‘å­—æ®µï¼Ÿ</h3>
<p>A: éµå¾ªå•ä¸€è´£ä»»åŸåˆ™ï¼Œæ¯ä¸ª Schema åº”è¯¥ä¸“æ³¨äºæè¿°ä¸€ä¸ªæ¸…æ™°çš„ä¸šåŠ¡äº‹ä»¶æˆ–å®ä½“ã€‚é€šå¸¸ä¿æŒåœ¨ 10-15 ä¸ªå­—æ®µä»¥å†…ä¸ºå®œï¼Œè¿‡å¤§çš„ Schema åº”è€ƒè™‘åˆ†è§£ã€‚</p>
<h3>Q: å¦‚ä½•å¤„ç†ä¸åŒç³»ç»Ÿä½¿ç”¨ä¸åŒç‰ˆæœ¬çš„æƒ…å†µï¼Ÿ</h3>
<p>A: Schema Center çš„ç‰ˆæœ¬æ§åˆ¶æœºåˆ¶å…è®¸å¤šä¸ªç‰ˆæœ¬å¹¶å­˜ã€‚ç¡®ä¿è¿›è¡Œå…¼å®¹æ€§æµ‹è¯•ï¼Œå¹¶åœ¨ç³»ç»Ÿé—´åè°ƒç‰ˆæœ¬è¿‡æ¸¡è®¡åˆ’ã€‚</p>
<hr/>
<div align="center">
<p>
    Schema Center - ä¸ºäº‹ä»¶é©±åŠ¨æ¶æ„ä¿é©¾æŠ¤èˆª
  </p>
<p>
<a href="https://github.com/yourusername/schema-center">GitHub</a> â€¢
    <a href="https://yourdomain.com/docs/schema-center">è¯¦ç»†æ–‡æ¡£</a> â€¢
    <a href="mailto:your-email@example.com">è”ç³»æ”¯æŒ</a>
</p>
</div>
</main>
<div class="toc">
<div class="toc-title">ç›®å½•</div>
<div id="toc-content"></div>
</div>
</div>
</div>
<script>
    // ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½
    (function() {
        const toggleButton = document.getElementById('theme-toggle');
        const body = document.documentElement;
        
        // æ£€æŸ¥æœ¬åœ°å­˜å‚¨çš„ä¸»é¢˜åå¥½
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            body.setAttribute('data-theme', savedTheme);
            toggleButton.textContent = savedTheme === 'dark' ? 'ğŸŒ™' : 'ğŸ”†';
        }
        
        // æ·»åŠ ç‚¹å‡»äº‹ä»¶
        toggleButton.addEventListener('click', function() {
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            body.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            // æ›´æ–°å›¾æ ‡
            toggleButton.textContent = newTheme === 'dark' ? 'ğŸŒ™' : 'ğŸ”†';
        });
    })();
    
    // ç”Ÿæˆç›®å½•
    (function() {
        const content = document.querySelector('.content');
        const headings = content.querySelectorAll('h2, h3, h4');
        const tocContent = document.getElementById('toc-content');
        
        if (headings.length === 0) {
            document.querySelector('.toc').style.display = 'none';
            return;
        }
        
        const toc = document.createElement('ul');
        tocContent.appendChild(toc);
        
        headings.forEach((heading, index) => {
            // ä¸ºæ¯ä¸ªæ ‡é¢˜æ·»åŠ  ID
            if (!heading.id) {
                heading.id = `heading-${index}`;
            }
            
            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = `#${heading.id}`;
            a.textContent = heading.textContent;
            
            if (heading.tagName === 'H3') {
                li.style.marginLeft = '1em';
            } else if (heading.tagName === 'H4') {
                li.style.marginLeft = '2em';
            }
            
            li.appendChild(a);
            toc.appendChild(li);
        });
    })();
    
    // æœç´¢åŠŸèƒ½
    (function() {
        const searchInput = document.getElementById('search-input');
        
        if (searchInput) {
            const schemaItems = document.querySelectorAll('.schema-list li');
            
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                
                schemaItems.forEach(item => {
                    const text = item.textContent.toLowerCase();
                    if (text.includes(searchTerm)) {
                        item.style.display = 'block';
                    } else {
                        item.style.display = 'none';
                    }
                });
            });
        }
    })();
    </script>
</body>
</html>

# Logto 中心身份基座集成方案

## 重新理解 Logto

### Logto 是什么
Logto 是一个开源的用户身份管理系统，提供：
- **OAuth 2.1 / OpenID Connect** 标准协议
- **多租户 SaaS** 架构
- **SSO 和 RBAC** 功能
- **管理控制台** 和 **SDK**

### 正确的集成方式

#### 1. Logto 作为独立的身份服务
```
┌─────────────────────────────────────────────────────────────┐
│                    Logto 身份服务                            │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────┐ │
│  │   OAuth2    │ │   OIDC      │ │   管理台    │ │   SDK   │ │
│  └─────────────┘ └─────────────┘ └─────────────┘ └─────────┘ │
└─────────────────────────────────────────────────────────────┘
                              │
                    ┌─────────┼─────────┐
                    │         │         │
            ┌───────▼──────┐ ┌▼──────┐ ┌▼──────┐
            │   WMS        │ │ GoData│ │  CMS  │
            │  系统        │ │ 系统  │ │ 系统  │
            └──────────────┘ └───────┘ └───────┘
                              │
                    ┌─────────▼─────────┐
                    │   IDP Framework   │
                    │  ┌─────────────┐  │
                    │  │  Logto      │  │
                    │  │  Adapter    │  │
                    │  └─────────────┘  │
                    └───────────────────┘
```

## 简化架构设计

### 1. 基础设施层 - 最小化集成
```
src/idp/framework/infrastructure/identity/
├── __init__.py
├── logto_adapter.py          # Logto SDK 适配器
├── auth_middleware.py        # 认证中间件
└── config.py                 # 配置管理
```

### 2. 核心功能
- **认证**: 使用 Logto SDK 处理 OAuth 流程
- **授权**: 通过 Logto 的 JWT 令牌验证权限
- **多租户**: 利用 Logto 的多租户功能
- **SSO**: 天然支持，无需额外实现

## 实施步骤

### 阶段一：Logto 部署
1. 部署 Logto 服务
2. 配置多租户
3. 创建应用和配置 OAuth

### 阶段二：Framework 集成
1. 实现 Logto 适配器
2. 实现认证中间件
3. 配置依赖注入

### 阶段三：子应用集成
1. 在子应用中添加 Logto 配置
2. 使用认证中间件
3. 测试 SSO 流程

## 优势
- **标准化**: 使用 OAuth 2.1 / OIDC 标准
- **简化**: 无需实现复杂的身份逻辑
- **安全**: 专业的安全团队维护
- **可扩展**: 支持多种认证方式 